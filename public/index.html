<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RAG Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <div class="max-w-4xl mx-auto p-4">
      <h1 class="text-2xl font-bold mb-4">RAG Chat</h1>
      <div class="flex gap-2 mb-4">
        <button id="ingestBtn" class="px-3 py-2 bg-blue-600 text-white rounded">Ingest Local PDFs</button>
        <span id="ingestStatus" class="text-sm text-gray-600"></span>
      </div>
      <div id="messages" class="space-y-3 mb-4 bg-white p-3 rounded border h-[60vh] overflow-auto"></div>
      <form id="askForm" class="flex gap-2">
        <input id="question" class="flex-1 border rounded px-3 py-2" placeholder="Ask a question..." />
        <button class="px-3 py-2 bg-green-600 text-white rounded">Ask</button>
      </form>
    </div>
    <script>
      const messages = document.getElementById('messages');
      const ingestBtn = document.getElementById('ingestBtn');
      const ingestStatus = document.getElementById('ingestStatus');
      const askForm = document.getElementById('askForm');
      const questionEl = document.getElementById('question');

      function addRow(role, text) {
        const div = document.createElement('div');
        div.className = 'p-3 rounded ' + (role === 'user' ? 'bg-blue-50' : 'bg-gray-100');
        div.textContent = (role === 'user' ? 'You: ' : 'Assistant: ') + text;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
      }

      ingestBtn.onclick = async () => {
        ingestStatus.textContent = 'Ingesting...';
        try {
          const res = await fetch('/api/ingest', { method: 'POST', headers: { 'Content-Type': 'application/json' } });
          const data = await res.json();
          if (data.ok) {
            ingestStatus.textContent = `Ingested ${data.totalStored} chunks from ${data.paths.length} PDFs.`;
          } else {
            ingestStatus.textContent = 'Ingest failed: ' + data.error;
          }
        } catch (e) {
          ingestStatus.textContent = 'Ingest failed: ' + e.message;
        }
      };

      askForm.onsubmit = async (e) => {
        e.preventDefault();
        const q = questionEl.value.trim();
        if (!q) return;
        addRow('user', q);
        questionEl.value = '';
        try {
          const res = await fetch('/api/ask', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ question: q }) });
          const data = await res.json();
          addRow('assistant', data.ok ? data.answer : ('Error: ' + data.error));
        } catch (e) {
          addRow('assistant', 'Error: ' + e.message);
        }
      };
    </script>
  </body>
  </html>


